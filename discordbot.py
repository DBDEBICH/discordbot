import discord
from discord import utils

POST_ID = '745618105983828008' #post id to read reactions from

#roles list according to emotes
ROLES = {
	'üíô': '745583364068737076',
	'üíö': '745634951852195961',
	'üíõ': '745634956063146085',
	'üíú': '745634959422914632'
}

#exclude this roles from counting
EXCROLES = ()

MAX_ROLES_PER_USER = 5 #max ammount of roles a user can have

class MyClient(discord.Client):
	async def on_ready(self):
		print('Logged on as {0}!'.format(self.user))

	async def on_raw_reaction_add(self, payload):
		channel = self.get_channel(payload.channel_id) # –ø–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç –∫–∞–Ω–∞–ª–∞
		message = await channel.fetch_message(payload.message_id) # –ø–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
		member = utils.get(message.guild.members, id=payload.user_id) # –ø–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–æ—Ç–æ—Ä—ã–π –ø–æ—Å—Ç–∞–≤–∏–ª —Ä–µ–∞–∫—Ü–∏—é

		try:
			emoji = str(payload.emoji) # —ç–º–æ–¥–∂–∏–∫ –∫–æ—Ç–æ—Ä—ã–π –≤—ã–±—Ä–∞–ª —é–∑–µ—Ä
			role = utils.get(message.guild.roles, id=int(ROLES[emoji])) # –æ–±—ä–µ–∫—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ä–æ–ª–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
			
			await member.add_roles(role)
			print('[SUCCESS] User {0.display_name} has been granted with role {1.name}'.format(member, role))
			
		except KeyError as e:
			print('[ERROR] KeyError, no role found for ' + emoji)
		except Exception as e:
			print(repr(e))

	async def on_raw_reaction_remove(self, payload):
		channel = self.get_channel(payload.channel_id) # –ø–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç –∫–∞–Ω–∞–ª–∞
		message = await channel.fetch_message(payload.message_id) # –ø–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
		member = utils.get(message.guild.members, id=payload.user_id) # –ø–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–æ—Ç–æ—Ä—ã–π –ø–æ—Å—Ç–∞–≤–∏–ª —Ä–µ–∞–∫—Ü–∏—é

		try:
			emoji = str(payload.emoji) # —ç–º–æ–¥–∂–∏–∫ –∫–æ—Ç–æ—Ä—ã–π –≤—ã–±—Ä–∞–ª —é–∑–µ—Ä
			role = utils.get(message.guild.roles, id=int(ROLES[emoji])) # –æ–±—ä–µ–∫—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ä–æ–ª–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)

			await member.remove_roles(role)
			print('[SUCCESS] Role {1.name} has been remove for user {0.display_name}'.format(member, role))

		except KeyError as e:
			print('[ERROR] KeyError, no role found for ' + emoji)
		except Exception as e:
			print(repr(e))

client = MyClient()
client.run('token')
